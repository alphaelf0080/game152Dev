# **《好運咚咚》遊戲分析文件**

## **1. 遊戲總覽與核心玩法**

《好運咚咚》是一款 5 滾輪、3 行的影片老虎機遊戲。其核心玩法循環始於玩家按下「旋轉」按鈕。客戶端（遊戲前端）會向伺服器發送請求，伺服器隨後返回該次旋轉的最終結果。客戶端負責透過動畫和聲音將此結果視覺化地呈現給玩家。

遊戲包含一個**主遊戲 (Base Game)** 和一個**免費旋轉 (Free Spins)** 的獎勵回合。同時，它也整合了多種現代老虎機的機制，例如**特色購買 (Feature Buy)** 選項、**巨獎 (Big Win)** 慶祝動畫，以及一個漸進式的 **連擊/連結 (Combo/Link)** 機制。

### **1.1. 243 Ways 贏分機制**

遊戲採用 **243-way** 贏分系統，不同於傳統的賠付線制度：

#### **贏分條件**
- **連續原則**: 獲勝符號必須從**最左側滾輪（第1輪）開始**，在**連續相鄰的滾輪**上出現
- **任意位置**: 符號可以出現在滾輪的任意行（上、中、下）
- **不需連線**: 不需要符號排列在固定的線路上

#### **贏分計算公式**

總贏分方式數 = **連續各滾輪上相同符號數量的乘積**

**範例說明：**

```
滾輪位置:    R1    R2    R3    R4    R5
符號分布:   [圖標] [圖標] [圖標] [其他] [其他]
數量:         1      3      2      -      -

計算: 1 × 3 × 2 = 6 ways
```

**詳細範例（如圖示）：**

- **情況 1（✓ 贏分）**:
  ```
  R1: 2個相同符號
  R2: 3個相同符號  
  R3: 2個相同符號
  → 總 Ways = 2 × 3 × 2 = 12 ways
  ```

- **情況 2（✗ 不贏分）**:
  ```
  R1: 1個符號
  R2: 0個相同符號（中斷）
  R3: 3個符號
  → 因為第2輪中斷，不構成贏分
  ```

#### **符號賠率與贏分公式**

**最終贏分 = (Ways數量) × (符號賠率) × (每注金額)**

以圖中範例說明：
- **問號符號 (?)** 賠率表:
  - 5 連: 500倍
  - 4 連: 100倍
  - 3 連: 10倍

- **計算範例**: 
  ```
  Ways: 6 ways (1×3×2)
  符號: 4連問號 (賠率100)
  贏分 = 10 (押注) × 6 (ways) = 60
  ```

**注意**: 示例中顯示的 `10 × 6 = 60` 是簡化計算，實際應包含符號賠率。





《好運咚咚》(PSS-ON-0.0.170) 遊戲玩法與邏輯說明
1. 遊戲基本規格
遊戲名稱: 好運咚咚 (PSS-ON-00170)
滾輪規格: 5 滾輪 x 3 行
遊戲類型: 243-way (243 種贏分方式)
基礎押分: 50 Credit
2. 核心玩法 (243-way)
贏分方式: 遊戲沒有傳統的賠付線。只要從最左邊的滾輪 (第 1 輪) 開始，連續相鄰的滾輪上出現相同的圖標，即可構成贏分。
贏分計算: 總贏分方式的數量，是透過將每個滾輪上出現的相鄰獲勝圖標數量相乘來計算。例如，第 1 輪有 2 個 'A'，第 2 輪有 3 個 'A'，第 3 輪有 1 個 'A'，則贏分方式為 2 * 3 * 1 = 6 ways。
3. 免費旋轉 (Free Spins) 特色
3.1. 觸發條件
當滾輪的第 1、2、3 輪上任意位置出現 3 個 <BONUS> 圖標時，即可觸發 7 次免費旋轉。
3.2. 特色玩法：戰鼓倍率 (War Drum Feature)
戰鼓出現: 進入免費旋轉後，滾輪上方會出現 [鼓 ICON] (根據購買選項，可能有 1 至 3 個)。
隨機倍率: 在每一次免費旋轉有得分後，每一個 [鼓 ICON] 都會開出一個 1x 至 10x 的隨機倍率。
倍率加總與套用: 若該次旋轉有得分，其總分將會乘以所有 [鼓 ICON] 上顯示的倍率總和。例如，若有兩個鼓，分別開出 3x 和 5x，則該把的贏分會再乘以 (3+5) = 8 倍。
特效:
當鼓開出 5x-9x 倍率時，會有震波特效。
當開出 10x 倍率時，會有更華麗的特效。
3.3. 特色玩法：圖標變換
P系列圖標變換: 在每一次免費旋tran 開始前，盤面上所有 P 系列的圖標 (P1, P2, P3, P4, P5) 都會隨機變成另一種 P 系列圖標。變化完成後，滾輪才會開始旋轉。
隨機權重: 變換的機率並非均等，高階圖標 (如 P5) 的出現機率較低 (約 30%)，而低階圖標 (如 P1) 的出現機率較高 (約 10%)。
全盤寶藏圖標: 當盤面出現隨機的「寶藏圖標」時，所有在滾輪上的其他「寶藏圖標」都會變成與該隨機圖標相同。
3.4. 再觸發 (Retrigger)
在免費旋轉期間，若再次於第 1、2、3 輪上出現 3 個 <BONUS> 圖標，可額外獲得 7 次免費旋轉。
免費旋轉的次數上限為 70 次。
4. 購買特色選項 (Feature Buy)
玩家可以支付特定倍數的押注來直接進入免費旋轉，並決定上方 [鼓 ICON] 的數量：

Cost 60x: 支付 60 倍押注，免費旋轉時上方有 1 個鼓。
Cost 80x: 支付 80 倍押注，免費旋轉時上方有 2 個鼓。
Cost 100x: 支付 100 倍押注，免費旋轉時上方有 3 個鼓。
5. 其他遊戲邏輯
五階報獎: 遊戲設有五個等級的巨獎動畫。當單次總贏分達到特定押注倍數時（公版門檻為 15x, 30x, 50x, 100x, 200x），會觸發對應等級的慶祝動畫。
新手模式: 針對遊玩次數低於 1000 場的玩家，五階報獎的觸發門檻會降低 (8x, 15x, 30x, 50x, 100x)，使其更容易觸發。
聽牌慢動作 (Slow Motion): 當 <BONUS> 圖標出現在第 1 和第 2 輪時，第 3 輪會進入慢動作旋轉，以營造緊張感。


---

## **2. 高層架構**

本遊戲基於組件導向的架構（很可能使用 Cocos Creator 引擎）。其邏輯被劃分為數個權責單一的控制器，這些控制器透過一個中央事件系統和一個共享的資料庫進行通訊。

### **關鍵架構組件：**

*   **`StateConsole` (大腦):** 作為遊戲的主控制器，管理著遊戲的狀態機。它主導了遊戲從 `待機(Idle)` -> `旋轉(Spin)` -> `顯示贏分(Show Win)` -> `觸發特色(Feature Trigger)` 等狀態的流程。所有其他組件都會監聽來自 `StateConsole` 的狀態變更並作出相應的反應。
*   **`ProtoConsole` (網路層):** 此控制器處理所有與遊戲伺服器之間的 WebSocket 通訊。它負責發送玩家的操作（如旋轉）並接收來自伺服器的權威性遊戲結果。它還負責解碼伺服器的回應並填充遊戲的資料模型。
*   **`MathConsole` (資料儲存庫):** 此組件持有從伺服器接收到的單次旋轉的數學結果。它包含 `WinData` 物件，該物件內含最終的滾輪位置、贏分線、贏分金額、特色遊戲觸發資訊以及特殊效果（如慢動作）的指令。它本身**不**執行任何計算。
*   **`DataController` (靜態資料庫):** 作為遊戲的全域靜態資料庫。它儲存共享資料、設定（如滾輪尺寸）以及遊戲狀態（`FSM`）、事件和場景的列舉。它為常數和共享的控制器實例提供了一個統一的存取點。
*   **`ReelController` (視覺層):** 此控制器管理滾輪的視覺呈現。它處理旋轉動畫、圖標顯示、停止效果以及特殊的滾輪效果（如「慢動作」）來營造期待感。
*   **`ShowWinController` (贏分展演):** 此控制器負責滾輪停止後整個贏分展演的流程。它從 `MathConsole` 讀取贏分資料，並統籌贏分線、圖標特效和上方橫幅的動畫更新。
*   **`AnimationController` & `AudioController` (展演層):** 這些控制器管理遊戲的整體視覺和聽覺感受，處理「巨獎」動畫序列、背景特效、場景轉換、背景音樂和音效。
*   **`EventController` (神經系統):** 一個簡單的事件中心，允許組件廣播和監聽遊戲事件（例如 `eUI_SPIN`、`eSTATECHANGE`），從而降低主要控制器之間的耦合度。

---

## **3. 遊戲邏輯與流程**

### **3.1. 主遊戲循環**

1.  **待機狀態:** 遊戲以 `K_IDLE` 狀態開始，等待玩家輸入。
2.  **玩家點擊旋轉:** UI 觸發 `StateConsole` 中的 `Spin()` 方法。
3.  **狀態變更 -> 旋轉:** `StateConsole` 轉換至 `K_SPIN` 狀態。
4.  **伺服器通訊:**
    *   `StateConsole` 呼叫 `ProtoConsole` 中的 `resultCall()`。
    *   `ProtoConsole` 透過 WebSocket 向伺服器發送 `ResultCall` 訊息，請求旋轉結果。
5.  **視覺與聽覺:**
    *   `ReelController` 偵測到 `K_SPIN` 狀態並開始滾輪旋轉動畫。
    *   `AudioController` 播放滾輪旋轉音效。
6.  **伺服器回應:** 伺服器傳回 `ResultRecall` 訊息，其中包含該次旋轉的完整 `WinData` 數據包。
7.  **資料處理:**
    *   `ProtoConsole` 接收訊息並呼叫內部的 `FillWinData` 函式。
    *   `FillWinData` 解析伺服器資料並填充 `MathConsole` 中的 `WinData` 物件。這包括最終滾輪位置 (`_rng`)、所有贏分線、總贏分 (`_wintotalcredit`) 以及任何特殊標記（如 `_slowmotion_flag`、特色觸發）。
8.  **滾輪停止:**
    *   `StateConsole` 轉換至 `K_SPINSTOPING` 狀態。
    *   `ReelController` 從 `MathConsole` 獲取最終滾輪位置，並根據 `_slowmotion_flag` 的指示，開始執行包含或不包含「慢動作」特效的滾輪停止序列。
9.  **贏分展演:**
    *   `StateConsole` 轉換至 `K_SHOWWIN` 狀態。
    *   `ShowWinController` 讀取處理後的贏分資料。
    *   它遍歷所有贏分線，在對應的 `Symbol` 組件上觸發動畫。
    *   如果贏分足夠大，`AnimationController` 會被呼叫以播放「巨獎」動畫和橫幅中贏分數字滾動的效果。
10. **循環結束:** 贏分展演結束後，`StateConsole` 檢查是否觸發了特色遊戲。
    *   如果**是**，則轉換至特色遊戲的狀態（例如 `K_FEATURE_TRIGGER`）。
    *   如果**否**，則返回 `K_IDLE` 狀態，等待下一次旋轉。

### **3.2. 免費旋轉特色**

*   **觸發:** 當伺服器結果指示有獎勵時，免費旋轉特色被觸發。`WinData` 物件將包含獎勵的免費旋轉次數 (`_triggerTimes`) 和下一個遊戲模組的 ID (`_nextmodule`)。`StateConsole` 透過 `isBonusTrigger()` 檢查來偵測此情況。
*   **轉換:** 遊戲進入 `K_FEATURE_TRANSLATE` 狀態。`AnimationController` 播放轉換動畫，`AudioController` 切換至免費旋轉的背景音樂。遊戲場景變更為 `FEATURE0`。
*   **玩法:** 遊戲進入特色專屬的循環 (`K_FEATURE_SPIN` -> `K_FEATURE_SPINSTOPING` -> `K_FEATURE_SHOWWIN`)。核心邏輯與主遊戲相似，但可能使用不同的滾輪盤面，並可能包含額外功能（如倍率）。
*   **再觸發 (Retrigger):** 在免費旋轉期間，此特色可以被再次觸發，從而增加總的免費旋轉次數。
*   **結束:** 當所有免費旋轉都結束後，遊戲進入 `K_FEATURE_CHEKRESULT` 狀態，播放一個顯示特色總贏分的總結/轉換動畫，然後返回主遊戲。

### **3.3. 特殊機制**

*   **特色購買 (Feature Buy):** `FeatureBuyController` 允許玩家支付其押注的固定倍數金額，以在下一次旋轉中強制觸發免費旋轉特色。
*   **圖標變換 (Symbol Change / Transformation):** 伺服器回傳的 `WinData` 可以指定一個 `line_no` 為 999 的贏分。這是一個旗標，指示客戶端播放一個「變盤」動畫，滾輪上的圖標會變換成另一種圖標來產生贏分。此邏輯由 `ShowWinController` 和 `Symbol` 組件處理。
*   **倍率 (Multiplier):** `MultipleController` 的存在表明遊戲中存在一個贏分倍率機制，很可能在免費旋轉回合中啟用。伺服器結果 (`slot_result_proto.multiplier_alone`) 提供了要顯示的倍率值。
*   **連擊/連結機制 (Combo / Link Mechanic):** `SpreadController` 的邏輯指向一個更複雜的連擊機制。在該機制中，收集贏分圖標會增加一個 `_lineCount`（連線計數），計數增加可以「升級」(`_linkLevel`)，從而可能帶來更大的獎勵。這似乎是一個與標準贏分線計算並行運行的次要特色。

---

## **4. 免費旋轉詳細機制**

### **4.1. 購買選項表 (Feature Buy Options)**

根據圖片顯示，玩家可以選擇三種購買方案進入免費旋轉：

| 購買方案 | 成本 | 戰鼓數量 | 說明 |
|---------|------|---------|------|
| **P3-X5** | 100倍押注 | 3個鼓 | 最高倍率潛力，適合激進玩家 |
| **P3-X4** | 80倍押注 | 2個鼓 | 平衡風險與報酬 |
| **P3-X3** | 60倍押注 | 1個鼓 | 最低成本入場 |

**購買後效果**:
- 立即進入免費旋轉模式（7次）
- 根據購買方案，螢幕上方出現對應數量的戰鼓
- 戰鼓將在每次有贏分的旋轉中開出隨機倍率

### **4.2. 符號變化機制 (Symbol Transformation)**

#### **變化時機與邏輯**

從第二張圖片可以看出，遊戲具有特殊的**符號變化系統**：

**示意圖解析 - 情境 1（V 變化）**:
```
變化前:
┌────┬────┬────┬────┬────┐
│ P3 │ P3 │ K  │ P1 │ P4 │
│ P5 │ P3 │ P3 │ T  │ K  │
│ T  │ P3 │ P3 │ P4 │ K  │
└────┴────┴────┴────┴────┘
         ↓ V (變化指令)

變化後:
┌────┬────┬────┬────┬────┐
│ P3 │ P3 │ K  │ P1 │ P4 │
│ P5 │ P3 │ T  │ P3 │ K  │
│ T  │ P3 │ P4 │ P3 │ K  │
└────┴────┴────┴────┴────┘
```

**示意圖解析 - 情境 2（X 變化）**:
```
變化前:
┌────┬────┬────┬────┬────┐
│ P3 │ P3 │ K  │ P1 │ P4 │
│ P5 │ P3 │ T  │ P3 │ K  │
│ T  │ P3 │ P4 │ P3 │ K  │
└────┴────┴────┴────┴────┘
         ↓ X (變化指令)

（顯示最終變化結果）
```

#### **變化規則分析**

根據圖表標示，可推斷以下規則：

1. **觸發條件**: 
   - 在免費旋轉期間，每次旋轉開始前觸發
   - 可能由伺服器指定變化模式（V、X等）

2. **變化對象**:
   - 主要針對 **P系列符號** (P1, P2, P3, P4, P5)
   - 其他符號（K, T等）通常保持不變

3. **變化模式**:
   - **V模式**: 特定位置的符號進行垂直或局部變換
   - **X模式**: 可能是交叉或對角變換
   - 變化後的符號類型由伺服器決定

4. **策略意義**:
   - 將低賠率符號變成高賠率符號
   - 增加連續符號數量，提升 Ways 數
   - 創造更多贏分組合

#### **程式碼對應**

在 `ShowWinController` 中，當 `line_no == 999` 時：
```typescript
// 偽代碼示意
if (winLine.line_no === 999) {
    // 觸發符號變換動畫
    this.playSymbolTransformation();
    // 變換完成後重新計算 Ways
    this.recalculateWinWays();
}
```

### **4.3. 賠率表 (Paytable)**

根據第二張圖片上方的賠率表：

| 符號 | 5連 | 4連 | 3連 |
|------|-----|-----|-----|
| **P3** | 100x | 50x | 25x |

**說明**:
- P3 為中高階符號
- 連續5個P3 = 100倍押注
- 配合 243 Ways 機制，實際贏分會乘以 Ways 數
- 在免費旋轉中，還會再乘以戰鼓倍率

**完整贏分計算範例**:
```
基礎押注: 50 Credit
P3連續數: 5個
Ways數: 12 ways (例: 2×3×2)
戰鼓倍率: 8x (例: 3x + 5x)

最終贏分 = 50 × 100 (P3賠率) × 12 (ways) × 8 (戰鼓)
        = 480,000 Credit
```

### **4.4. 戰鼓倍率特效層級**

根據原文說明，戰鼓開出倍率時的視覺效果：

| 倍率範圍 | 視覺特效 | 稀有度 |
|---------|---------|--------|
| **1x - 4x** | 標準動畫 | 常見 |
| **5x - 9x** | 震波特效 | 中等 |
| **10x** | 華麗特效 + 音效 | 稀有 |

**多個戰鼓疊加效果**:
- 3個鼓同時開出 10x = 總倍率 30x
- 配合高 Ways 數，可產生巨額贏分