# LangBunder è¼‰å…¥ç­–ç•¥åˆ†æ

> åˆ†ææ—¥æœŸ: 2025-10-13  
> è­°é¡Œ: Node é€£çµ vs db:// è·¯å¾‘è¼‰å…¥çš„å„ªåŠ£æ¯”è¼ƒ

---

## ğŸ“Œ å•é¡Œæ¦‚è¿°

ç›®å‰ LangBunder ä½¿ç”¨ **Node é€£çµæ–¹å¼**ï¼š
- é…ç½®æª”æŒ‡å®šç¯€é»è·¯å¾‘ (å¦‚ `"Canvas/BaseGame/Layer/Shake/Animation/BigwinAnm/BWinSlogan"`)
- é€é `cc.find()` æˆ– `NodeCache` æ‰¾åˆ°ç¯€é»
- å–å¾—ç¯€é»ä¸Šçš„çµ„ä»¶ (Sprite, Spine, LabelAtlas)
- å°‡è¼‰å…¥çš„è³‡æºè³¦å€¼çµ¦çµ„ä»¶

æ˜¯å¦æ”¹ç”¨ **db:// è·¯å¾‘è¼‰å…¥**æœƒæ›´å¥½ï¼Ÿ

---

## âš–ï¸ æ–¹å¼æ¯”è¼ƒ

### ğŸ”µ æ–¹å¼ä¸€ï¼šNode é€£çµï¼ˆç¾è¡Œï¼‰

#### å·¥ä½œæµç¨‹
```typescript
// 1. å¾é…ç½®è®€å–ç›®æ¨™ç¯€é»è·¯å¾‘
"targets": ["Canvas/BaseGame/Layer/BigwinAnm/BWinSlogan"]

// 2. é€é NodeCache æ‰¾åˆ°ç¯€é»
const node = this.nodeCache.getNode("Canvas/BaseGame/Layer/BigwinAnm/BWinSlogan");

// 3. å–å¾—çµ„ä»¶
const sprite = node.getComponent(cc.Sprite);

// 4. è¼‰å…¥è³‡æº
const resource = await this.loadResource("anm/bigwin", "sp.SkeletonData");

// 5. è³¦å€¼
sprite.spriteFrame = resource;
```

#### å„ªé» âœ…
1. **å ´æ™¯è€¦åˆæ€§å¼·** - ç›´æ¥æ“ä½œå ´æ™¯ä¸­å·²å­˜åœ¨çš„ UI å…ƒç´ 
2. **çµ„ä»¶å±¬æ€§å®Œæ•´** - å¯ä»¥ç›´æ¥å­˜å–å’Œä¿®æ”¹ç¯€é»çš„æ‰€æœ‰å±¬æ€§ï¼ˆä½ç½®ã€ç¸®æ”¾ã€é€æ˜åº¦ç­‰ï¼‰
3. **å³æ™‚åé¥‹** - è³‡æºè¼‰å…¥å¾Œç«‹å³æ‡‰ç”¨åˆ°å ´æ™¯ï¼Œè¦–è¦ºæ•ˆæœå³æ™‚å¯è¦‹
4. **æ”¯æ´è¤‡é›œæ“ä½œ** - å¯åŸ·è¡Œ postActionsï¼ˆè¨­å®šå‹•ç•«ã€èª¿æ•´å±¬æ€§ç­‰ï¼‰
5. **é™¤éŒ¯å®¹æ˜“** - å¯åœ¨ Cocos Creator ç·¨è¼¯å™¨ä¸­ç›´æ¥æŸ¥çœ‹ç¯€é»çµæ§‹
6. **ç›¸ä¾æ€§ç®¡ç†** - ç¯€é»é–“çš„çˆ¶å­é—œä¿‚ã€äº‹ä»¶ç¶å®šè‡ªå‹•ç¶­è­·

#### ç¼ºé» âŒ
1. **å ´æ™¯è¼‰å…¥ä¾è³´** - å¿…é ˆç­‰å ´æ™¯å®Œå…¨è¼‰å…¥å¾Œæ‰èƒ½åŸ·è¡Œ
2. **ç¯€é»è·¯å¾‘è„†å¼±** - å ´æ™¯çµæ§‹è®Šæ›´æœƒå°è‡´è·¯å¾‘å¤±æ•ˆ
3. **find() æ•ˆèƒ½æˆæœ¬** - å³ä½¿æœ‰å¿«å–ï¼Œé¦–æ¬¡æŸ¥æ‰¾ä»æœ‰é–‹éŠ·
4. **ç„¡æ³•é è¼‰** - ç„¡æ³•åœ¨å ´æ™¯è¼‰å…¥å‰æº–å‚™è³‡æº

---

### ğŸŸ¢ æ–¹å¼äºŒï¼šdb:// è·¯å¾‘è¼‰å…¥

#### å·¥ä½œæµç¨‹
```typescript
// 1. å¾é…ç½®è®€å–è³‡æºè·¯å¾‘
"resources": ["db://languages/sch/animation/bigwin"]

// 2. ç›´æ¥è¼‰å…¥è³‡æº
const resource = await cc.resources.load(
    "db://languages/sch/animation/bigwin", 
    cc.SpriteFrame
);

// 3. å„²å­˜åˆ°è³‡æºæ± 
this.resourceManager.set("bigwin_sch", resource);

// 4. ï¼ˆéœ€è¦æ™‚ï¼‰æ‰‹å‹•è³¦å€¼çµ¦ç¯€é»
const node = cc.find("Canvas/BigwinAnm");
node.getComponent(cc.Sprite).spriteFrame = resource;
```

#### å„ªé» âœ…
1. **è³‡æºç¨ç«‹æ€§** - è³‡æºè¼‰å…¥ä¸ä¾è³´å ´æ™¯çµæ§‹
2. **é è¼‰èƒ½åŠ›** - å¯åœ¨ä»»ä½•æ™‚æ©Ÿé å…ˆè¼‰å…¥è³‡æº
3. **è·¯å¾‘æ˜ç¢º** - è³‡æ–™åº«è·¯å¾‘ä¸å—å ´æ™¯çµæ§‹å½±éŸ¿
4. **è³‡æºç®¡ç†é›†ä¸­** - çµ±ä¸€çš„è³‡æºå­˜å–ä»‹é¢
5. **è·¨å ´æ™¯å…±ç”¨** - è¼‰å…¥çš„è³‡æºå¯åœ¨å¤šå€‹å ´æ™¯ä½¿ç”¨
6. **æ•ˆèƒ½å„ªåŒ–æ½›åŠ›** - å¯å¯¦ç¾æ›´ç²¾ç´°çš„è³‡æºè¼‰å…¥ç­–ç•¥

#### ç¼ºé» âŒ
1. **éœ€è¦é¡å¤–çš„è³¦å€¼é‚è¼¯** - è¼‰å…¥å¾Œé‚„éœ€æ‰‹å‹•é€£çµåˆ°ç¯€é»
2. **é…ç½®è¤‡é›œåº¦æå‡** - éœ€åŒæ™‚ç®¡ç†è³‡æºè·¯å¾‘å’Œç¯€é»è·¯å¾‘
3. **ç„¡æ³•ç›´æ¥åŸ·è¡Œ postActions** - éœ€é¡å¤–è¨­è¨ˆçµ„ä»¶æ“ä½œæ©Ÿåˆ¶
4. **é™¤éŒ¯å›°é›£** - è³‡æºèˆ‡å ´æ™¯åˆ†é›¢ï¼Œå•é¡Œè¿½è¹¤è¼ƒè¤‡é›œ
5. **è¨˜æ†¶é«”ç®¡ç†è²¬ä»»** - éœ€æ‰‹å‹•ç®¡ç†è³‡æºçš„ç”Ÿå‘½é€±æœŸ

---

## ğŸ¯ é©ç”¨å ´æ™¯åˆ†æ

### âœ… Node é€£çµé©åˆçš„æƒ…æ³ï¼ˆæ¨è–¦ç¾è¡Œæ–¹å¼ï¼‰

1. **UI å¤šèªç³»åˆ‡æ›**
   - éŠæˆ²å…§çš„ UI å…ƒç´ éœ€è¦æ ¹æ“šèªè¨€åˆ‡æ›åœ–ç‰‡/æ–‡å­—
   - ä¾‹å¦‚ï¼šæŒ‰éˆ•ã€æ¨™ç±¤ã€èªªæ˜æ–‡å­—ã€å½ˆçª—æ¨™é¡Œ
   - âœ… **LangBunder çš„ä¸»è¦ä½¿ç”¨å ´æ™¯**

2. **å ´æ™¯å…§è³‡æºç†±æ›´æ–°**
   - è³‡æºéœ€è¦å³æ™‚æ›¿æ›ä¸¦é¡¯ç¤º
   - éœ€è¦åŸ·è¡Œè¤‡é›œçš„å¾Œè™•ç†ï¼ˆå‹•ç•«è¨­å®šã€å±¬æ€§èª¿æ•´ï¼‰

3. **å‹•æ…‹ UI ç³»çµ±**
   - UI å…ƒç´ éœ€è¦å‹•æ…‹èª¿æ•´ï¼ˆä½ç½®ã€ç¸®æ”¾ã€å‹•ç•«ï¼‰
   - éœ€è¦å­˜å–ç¯€é»çš„å®Œæ•´å±¬æ€§å’Œæ–¹æ³•

4. **Spine å‹•ç•«æ§åˆ¶**
   - éœ€è¦æ›´æ› Spine è³‡æºä¸¦ç«‹å³æ’­æ”¾æŒ‡å®šå‹•ç•«
   - ä¾‹å¦‚ï¼š`setAnimation(0, "idle", true)`

### âœ… db:// è·¯å¾‘é©åˆçš„æƒ…æ³

1. **è³‡æºé è¼‰ç³»çµ±**
   - Loading ç•«é¢é å…ˆè¼‰å…¥æ‰€æœ‰å¤šèªç³»è³‡æº
   - è³‡æºæ± ç®¡ç†

2. **è·¨å ´æ™¯è³‡æºå…±ç”¨**
   - åŒä¸€ä»½è³‡æºåœ¨å¤šå€‹å ´æ™¯ä½¿ç”¨
   - ä¾‹å¦‚ï¼šé€šç”¨çš„åœ–æ¨™ã€æŒ‰éˆ•ç´ æ

3. **å‹•æ…‹å¯¦ä¾‹åŒ–**
   - æ ¹æ“šè³‡æºå‹•æ…‹å‰µå»ºç¯€é»
   - ä¾‹å¦‚ï¼šåˆ—è¡¨é …ã€å¡ç‰‡ç³»çµ±

4. **è³‡æºæ‰“åŒ…å„ªåŒ–**
   - éœ€è¦ç²¾ç¢ºæ§åˆ¶è³‡æºè¼‰å…¥æ™‚æ©Ÿ
   - å¯¦ç¾åˆ†åŒ…è¼‰å…¥ç­–ç•¥

---

## ğŸ’¡ å»ºè­°æ–¹æ¡ˆ

### ğŸ† æ¨è–¦ï¼šä¿æŒç¾è¡Œçš„ Node é€£çµæ–¹å¼

**ç†ç”±ï¼š**

1. **ç¬¦åˆ LangBunder çš„è¨­è¨ˆç›®æ¨™**
   - ä¸»è¦ç”¨é€”æ˜¯**å ´æ™¯å…§çš„å¤šèªç³» UI åˆ‡æ›**
   - éœ€è¦**å³æ™‚æ›´æ–°**è¦–è¦ºå…ƒç´ 
   - éœ€è¦åŸ·è¡Œ**è¤‡é›œçš„å¾Œè™•ç†**ï¼ˆpostActionsï¼‰

2. **é–‹ç™¼æ•ˆç‡é«˜**
   - è¨­è¨ˆå¸«åœ¨ Cocos Creator ç·¨è¼¯å™¨ä¸­ä½ˆå±€ UI
   - é–‹ç™¼è€…åªéœ€é…ç½®ç¯€é»è·¯å¾‘å³å¯
   - ç„¡éœ€é¡å¤–çš„è³‡æºç¶å®šé‚è¼¯

3. **ç¾è¡Œå¯¦ä½œå·²å„ªåŒ–**
   - `NodeCache` å·²è§£æ±ºé‡è¤‡æŸ¥æ‰¾å•é¡Œ
   - `ResourceManager` å·²å¯¦ç¾è¨˜æ†¶é«”ç®¡ç†
   - `ConfigManager` å·²å¯¦ç¾é…ç½®é©…å‹•

4. **å¯ç¶­è­·æ€§ä½³**
   - é…ç½®æª”æ¸…æ™°è¡¨é”ã€Œå“ªå€‹ç¯€é»ä½¿ç”¨å“ªå€‹è³‡æºã€
   - é™¤éŒ¯æ™‚å¯ç›´æ¥åœ¨ç·¨è¼¯å™¨ä¸­æª¢è¦–
   - postActions ç›´æ¥å°æ‡‰çµ„ä»¶æ“ä½œ

### ğŸ”§ æ”¹é€²å»ºè­°ï¼ˆéæ”¹ç”¨ db://ï¼‰

#### 1ï¸âƒ£ å¢å¼·è·¯å¾‘é©—è­‰
```typescript
// åœ¨é–‹ç™¼æ¨¡å¼ä¸‹é©—è­‰ç¯€é»è·¯å¾‘
if (CC_DEV) {
    const missingNodes = [];
    for (const path of config.targets) {
        if (!cc.find(path)) {
            missingNodes.push(path);
        }
    }
    if (missingNodes.length > 0) {
        console.warn('æ‰¾ä¸åˆ°ä»¥ä¸‹ç¯€é»:', missingNodes);
    }
}
```

#### 2ï¸âƒ£ æ”¯æ´ç¯€é»åˆ¥å
```json
{
  "nodeAliases": {
    "bigwinTitle": "Canvas/BaseGame/Layer/Shake/Animation/BigwinAnm/BWinTitle",
    "featureBuyBtn": "Canvas/BaseGame/Layer/Shake/UI/BsUI/FeatureBuyButton"
  },
  "resourceCategories": {
    "animations": {
      "bigwin": {
        "targets": ["@bigwinTitle"]  // ä½¿ç”¨åˆ¥å
      }
    }
  }
}
```

#### 3ï¸âƒ£ å ´æ™¯è®Šæ›´æª¢æ¸¬
```typescript
// ç›£è½å ´æ™¯è¼‰å…¥äº‹ä»¶ï¼Œæ¸…é™¤ç¯€é»å¿«å–
cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH, () => {
    this.nodeCache.clear();
    log('å ´æ™¯åˆ‡æ›ï¼Œå·²æ¸…é™¤ç¯€é»å¿«å–');
});
```

#### 4ï¸âƒ£ è³‡æºé è¼‰é¸é …
```json
{
  "resourceCategories": {
    "sprites": {
      "banner": {
        "preload": true,  // æ”¯æ´é è¼‰æ¨™è¨˜
        "path": "pic/banner",
        "targets": ["@bannerText"]
      }
    }
  }
}
```

---

## ğŸ”€ æ··åˆæ–¹æ¡ˆï¼ˆé€²éšï¼‰

å¦‚æœæœªä¾†æœ‰**è·¨å ´æ™¯è³‡æºå…±ç”¨**éœ€æ±‚ï¼Œå¯è€ƒæ…®æ··åˆæ–¹æ¡ˆï¼š

### æ¶æ§‹è¨­è¨ˆ
```typescript
class LangBunder {
    // æ–¹å¼ä¸€ï¼šå ´æ™¯å…§ UI æ›´æ–°ï¼ˆä¸»è¦ç”¨é€”ï¼‰
    async loadForNodes(category: string, language: string) {
        // ç¾è¡Œé‚è¼¯
        const config = this.getConfig(category);
        const resource = await this.loadResource(config.path, config.type);
        this.updateTargetComponents(config.targets, resource);
    }
    
    // æ–¹å¼äºŒï¼šè³‡æºæ± é è¼‰ï¼ˆå¯é¸åŠŸèƒ½ï¼‰
    async preloadResources(categories: string[], language: string) {
        for (const category of categories) {
            const config = this.getConfig(category);
            const path = `db://languages/${language}/${config.path}`;
            const resource = await cc.resources.load(path);
            this.resourceManager.set(`${category}_${language}`, resource);
        }
    }
    
    // å¾è³‡æºæ± ç²å–
    getPreloadedResource(category: string, language: string) {
        return this.resourceManager.get(`${category}_${language}`);
    }
}
```

### é…ç½®æ“´å±•
```json
{
  "resourceCategories": {
    "sprites": {
      "banner": {
        "loadMode": "immediate",  // immediate | preload | lazy
        "path": "pic/banner",
        "dbPath": "db://languages/{lang}/pic/banner",  // å¯é¸çš„ db è·¯å¾‘
        "targets": ["@bannerText"]
      }
    }
  }
}
```

---

## ğŸ“Š æ•ˆèƒ½å½±éŸ¿è©•ä¼°

### ç¾è¡Œæ–¹å¼ï¼ˆNode é€£çµï¼‰
```
åˆå§‹åŒ–éšæ®µ:
  â”œâ”€ å ´æ™¯è¼‰å…¥: ~500ms
  â”œâ”€ ç¯€é»æŸ¥æ‰¾ (é¦–æ¬¡): ~50ms (14å€‹ç¯€é»)
  â””â”€ ç¯€é»å¿«å–å»ºç«‹: ~5ms

èªè¨€åˆ‡æ›éšæ®µ:
  â”œâ”€ é…ç½®è®€å–: ~1ms (å·²å¿«å–)
  â”œâ”€ ç¯€é»å–å¾—: ~0.1ms (å¾å¿«å–)
  â”œâ”€ è³‡æºè¼‰å…¥: ~200ms (ç¶²è·¯/ç£ç¢Ÿ)
  â””â”€ çµ„ä»¶æ›´æ–°: ~10ms
  
ç¸½è¨ˆ: ~211ms / åˆ‡æ›
```

### db:// æ–¹å¼ï¼ˆé ä¼°ï¼‰
```
é è¼‰éšæ®µ:
  â”œâ”€ è³‡æºè¼‰å…¥: ~2000ms (æ‰€æœ‰èªè¨€)
  â””â”€ è³‡æºæ± å»ºç«‹: ~50ms

èªè¨€åˆ‡æ›éšæ®µ:
  â”œâ”€ è³‡æºå–å¾—: ~0.1ms (å¾è³‡æºæ± )
  â”œâ”€ ç¯€é»æŸ¥æ‰¾: ~50ms (ç„¡å¿«å–å„ªåŒ–)
  â””â”€ æ‰‹å‹•è³¦å€¼: ~20ms
  
ç¸½è¨ˆé è¼‰: ~2050ms
ç¸½è¨ˆåˆ‡æ›: ~70ms / åˆ‡æ›
```

### çµè«–
- **é¦–æ¬¡åˆ‡æ›**: Node é€£çµè¼ƒå¿« (211ms vs 2050ms)
- **å¾ŒçºŒåˆ‡æ›**: db:// æ–¹å¼è¼ƒå¿« (70ms vs 211ms)
- **è¨˜æ†¶é«”ä½”ç”¨**: db:// æ–¹å¼è¼ƒé«˜ (é è¼‰æ‰€æœ‰èªè¨€)

å°æ–¼å¤§éƒ¨åˆ†ç”¨æˆ¶**åªåˆ‡æ› 1-2 æ¬¡èªè¨€**çš„ä½¿ç”¨æƒ…å¢ƒï¼Œ**Node é€£çµæ–¹å¼æ•ˆèƒ½æ›´ä½³**ã€‚

---

## âœ… æœ€çµ‚çµè«–

### å»ºè­°ï¼š**ä¿æŒç¾è¡Œçš„ Node é€£çµæ–¹å¼**

**æ ¸å¿ƒç†ç”±ï¼š**
1. âœ… å®Œå…¨ç¬¦åˆ LangBunder çš„ä½¿ç”¨å ´æ™¯ï¼ˆå ´æ™¯å…§ UI å¤šèªç³»åˆ‡æ›ï¼‰
2. âœ… é–‹ç™¼æ•ˆç‡é«˜ï¼Œé…ç½®ç°¡æ½”æ˜“æ‡‚
3. âœ… å·²å¯¦ç¾çš„å„ªåŒ–è¶³å¤ ï¼ˆNodeCache, ResourceManagerï¼‰
4. âœ… æ”¯æ´è¤‡é›œçš„ postActions å’Œçµ„ä»¶æ“ä½œ
5. âœ… é™¤éŒ¯å’Œç¶­è­·å®¹æ˜“

**ä¸å»ºè­°æ”¹ç”¨ db:// çš„åŸå› ï¼š**
1. âŒ å¢åŠ é…ç½®è¤‡é›œåº¦ï¼ˆéœ€åŒæ™‚ç®¡ç†è³‡æºè·¯å¾‘å’Œç¯€é»è·¯å¾‘ï¼‰
2. âŒ éœ€è¦é¡å¤–çš„è³¦å€¼é‚è¼¯å±¤
3. âŒ postActions å¯¦ä½œè®Šè¤‡é›œ
4. âŒ é è¼‰æ‰€æœ‰èªè¨€é€ æˆè¨˜æ†¶é«”æµªè²»
5. âŒ å°æ–¼ã€Œåˆ‡æ›èªè¨€ã€é€™å€‹æ ¸å¿ƒåŠŸèƒ½æ²’æœ‰å¯¦è³ªæ•ˆèƒ½æå‡

### å¯é¸çš„å¢å¼·åŠŸèƒ½
å¦‚æœéœ€è¦æ›´éˆæ´»çš„æ¶æ§‹ï¼Œå¯è€ƒæ…®ï¼š
- âœ… å¢åŠ ç¯€é»åˆ¥åç³»çµ±
- âœ… å¯¦ä½œå ´æ™¯è®Šæ›´æª¢æ¸¬
- âœ… æ”¯æ´å¯é¸çš„è³‡æºé è¼‰æ¨¡å¼
- âœ… æä¾›æ··åˆè¼‰å…¥æ–¹æ¡ˆï¼ˆçµ¦ç‰¹æ®Šå ´æ™¯ä½¿ç”¨ï¼‰

---

## ğŸ“ è£œå……èªªæ˜

### é©åˆæ”¹ç”¨ db:// çš„æƒ…å¢ƒ
å¦‚æœæ‚¨çš„å°ˆæ¡ˆæœ‰ä»¥ä¸‹éœ€æ±‚ï¼Œå¯ä»¥è€ƒæ…®æ··åˆæ–¹æ¡ˆï¼š

1. **å¤§å‹å°ˆæ¡ˆ** - å¤šå€‹å ´æ™¯å…±ç”¨å¤šèªç³»è³‡æº
2. **è³‡æºåŒ…ç®¡ç†** - éœ€è¦ç²¾ç¢ºæ§åˆ¶è³‡æºè¼‰å…¥å’Œå¸è¼‰
3. **å‹•æ…‹ UI ç³»çµ±** - æ ¹æ“šé…ç½®å‹•æ…‹ç”Ÿæˆ UI
4. **ç¶²è·¯è³‡æº** - å¾é ç«¯æœå‹™å™¨è¼‰å…¥å¤šèªç³»è³‡æº

ä½†å°æ–¼ç›®å‰çš„ `game152Dev` å°ˆæ¡ˆï¼Œ**ç¾è¡Œçš„ Node é€£çµæ–¹å¼æ˜¯æœ€ä½³é¸æ“‡**ã€‚

---

**æ–‡ä»¶ç‰ˆæœ¬:** 1.0  
**æ›´æ–°æ—¥æœŸ:** 2025-10-13  
**ç¶­è­·è€…:** GitHub Copilot
