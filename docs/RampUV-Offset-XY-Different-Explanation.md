# Ramp UV Offset - ç‚ºä»€éº¼ X å’Œ Y çš„ Offset ä¸åŒï¼Ÿ

## ğŸ“… æ›´æ–°æ—¥æœŸ
2025-10-17

## âœ… é©—è­‰çµæœ

### å¯¦éš›æˆªåœ–æ•¸å€¼ï¼ˆContentSize = [696, 540]ï¼‰
- **Node UV Scale X**: 0.002874
- **Node UV Scale Y**: 0.003704
- **Ramp UV Offset X**: 0.498563
- **Ramp UV Offset Y**: 0.498148

### å…¬å¼è¨ˆç®—çµæœ
```typescript
width = 696
height = 540

// Node UV Scale
nodeUVScaleX = 2 / 696 = 0.002874 âœ“
nodeUVScaleY = 2 / 540 = 0.003704 âœ“

// Ramp UV Offset
offsetX = 0.5 - (1.0 / 696) = 0.498563 âœ“
offsetY = 0.5 - (1.0 / 540) = 0.498148 âœ“
```

**çµè«–ï¼šå…¬å¼è¨ˆç®—èˆ‡å¯¦éš›æ•¸å€¼å®Œå…¨ä¸€è‡´ï¼** ğŸ‰

---

## ğŸ” ç‚ºä»€éº¼ X å’Œ Y çš„ Offset ä¸åŒï¼Ÿ

### é—œéµç†è§£

#### âŒ éŒ¯èª¤ç†è§£
"X å’Œ Y çš„ offset æ‡‰è©²ç›¸åŒ"

#### âœ… æ­£ç¢ºç†è§£
**X å’Œ Y çš„ offset å¿…é ˆæ ¹æ“šå„è‡ªçš„ contentSize åˆ†åˆ¥è¨ˆç®—**

---

## ğŸ“ æ•¸å­¸åŸç†

### å…¬å¼æ¨å°

å°æ–¼ Cocos Creator çš„ UV åæ¨™ç³»çµ±ï¼š

```
a_position ç¯„åœï¼š[-contentSize/2, contentSize/2]
```

ç‚ºäº†æ­£ç¢ºå°é½Šåˆ° UV ç©ºé–“ [0, 1]ï¼Œéœ€è¦è£œå„Ÿé‚Šç•Œæ•ˆæœï¼š

```typescript
offsetX = 0.5 - (1.0 / width)
offsetY = 0.5 - (1.0 / height)
```

### ç‚ºä»€éº¼å¿…é ˆåˆ†é–‹è¨ˆç®—ï¼Ÿ

#### ä¾‹å­ 1: æ­£æ–¹å½¢ [512, 512]
```typescript
offsetX = 0.5 - (1/512) = 0.498047
offsetY = 0.5 - (1/512) = 0.498047
// X å’Œ Y ç›¸åŒ âœ“
```

#### ä¾‹å­ 2: çŸ©å½¢ [696, 540]ï¼ˆå¯¦éš›æ¡ˆä¾‹ï¼‰
```typescript
offsetX = 0.5 - (1/696) = 0.498563
offsetY = 0.5 - (1/540) = 0.498148
// X å’Œ Y ä¸åŒ âœ“
```

#### ä¾‹å­ 3: å¯¬å± [1920, 1080]
```typescript
offsetX = 0.5 - (1/1920) = 0.499479
offsetY = 0.5 - (1/1080) = 0.499074
// X å’Œ Y ä¸åŒ âœ“
```

---

## ğŸ¯ é—œéµæ´å¯Ÿ

### 1. Offset çš„æœ¬è³ªæ˜¯ã€Œåƒç´ è£œå„Ÿã€

```typescript
// è£œå„Ÿçš„åƒç´ æ•¸
compensationPixelsX = 1.0 / width
compensationPixelsY = 1.0 / height

// å› ç‚º width â‰  heightï¼Œæ‰€ä»¥è£œå„Ÿå€¼ä¸åŒ
```

### 2. æ­¸ä¸€åŒ–åˆ° UV ç©ºé–“

æ¯å€‹è»¸å‘éƒ½éœ€è¦ç¨ç«‹æ­¸ä¸€åŒ–ï¼š

```
X è»¸ï¼šåƒç´ ç©ºé–“ [0, width] â†’ UV ç©ºé–“ [0, 1]
Y è»¸ï¼šåƒç´ ç©ºé–“ [0, height] â†’ UV ç©ºé–“ [0, 1]
```

### 3. æ¯”ä¾‹é—œä¿‚

```typescript
// å°æ–¼ [696, 540]
ratio = width / height = 696 / 540 = 1.289

// Offset çš„å·®ç•°
offsetX - offsetY = 0.498563 - 0.498148 = 0.000415

// é€™å€‹å·®ç•°ä¾†è‡ªæ–¼å°ºå¯¸å·®ç•°
1/540 - 1/696 = 0.001852 - 0.001437 = 0.000415 âœ“
```

---

## ğŸ“Š ä¸åŒå°ºå¯¸çš„å°æ¯”

| ContentSize | Offset X | Offset Y | X - Y å·®ç•° |
|-------------|----------|----------|-----------|
| [512, 512] | 0.498047 | 0.498047 | 0.000000 |
| [696, 540] | 0.498563 | 0.498148 | 0.000415 |
| [1024, 768] | 0.499023 | 0.498698 | 0.000325 |
| [1280, 720] | 0.499219 | 0.498611 | 0.000608 |
| [1920, 1080] | 0.499479 | 0.499074 | 0.000405 |

**è§€å¯Ÿ**ï¼š
- æ­£æ–¹å½¢ï¼ˆ512Ã—512ï¼‰ï¼šX = Y
- çŸ©å½¢ï¼šX â‰  Y
- å¯¬é«˜æ¯”è¶Šå¤§ï¼Œå·®ç•°è¶Šæ˜é¡¯

---

## ğŸ’¡ è¦–è¦ºåŒ–ç†è§£

### åƒç´ ç¶²æ ¼å°é½Š

```
Width = 696 åƒç´ 
Height = 540 åƒç´ 

X æ–¹å‘éœ€è¦è£œå„Ÿï¼š1/696 â‰ˆ 0.001437 (æ›´å°çš„è£œå„Ÿ)
Y æ–¹å‘éœ€è¦è£œå„Ÿï¼š1/540 â‰ˆ 0.001852 (æ›´å¤§çš„è£œå„Ÿ)

å› ç‚º Y è»¸çš„åƒç´ å¯†åº¦è¼ƒä½ï¼ˆ540 < 696ï¼‰ï¼Œéœ€è¦è¼ƒå¤§çš„è£œå„Ÿå€¼
```

### UV åæ¨™è½‰æ›

```glsl
// Shader ä¸­çš„è½‰æ›
vec2 normalizedUV = (nodeUV * nodeUVScale + 1.0) * 0.5;

// X æ–¹å‘
normalizedUV.x = (nodeUV.x * 0.002874 + 1.0) * 0.5;

// Y æ–¹å‘  
normalizedUV.y = (nodeUV.y * 0.003704 + 1.0) * 0.5;

// å› ç‚º nodeUVScale ä¸åŒï¼Œæ‰€ä»¥ offset ä¹Ÿå¿…é ˆä¸åŒ
```

---

## ğŸ”§ å¯¦ç¾é©—è­‰

### ç•¶å‰å¯¦ç¾ï¼ˆæ­£ç¢ºï¼‰âœ…

```typescript
public static calculateAutoRampUVOffset(
    width: number, 
    height: number
): { x: number, y: number } {
    const offsetX = 0.5 - (1.0 / width);   // æ ¹æ“š width è¨ˆç®—
    const offsetY = 0.5 - (1.0 / height);  // æ ¹æ“š height è¨ˆç®—
    
    return {
        x: offsetX,
        y: offsetY
    };
}
```

### éŒ¯èª¤å¯¦ç¾ï¼ˆå‡è¨­ï¼‰âŒ

```typescript
// éŒ¯èª¤ï¼šä½¿ç”¨ç›¸åŒçš„ offset
public static calculateAutoRampUVOffset(
    width: number, 
    height: number
): { x: number, y: number } {
    const offset = 0.5 - (1.0 / Math.max(width, height));
    
    return {
        x: offset,  // âŒ éŒ¯èª¤
        y: offset   // âŒ éŒ¯èª¤
    };
}
```

é€™æœƒå°è‡´ï¼š
- X æ–¹å‘å°é½ŠéŒ¯èª¤ï¼ˆå¦‚æœ width > heightï¼‰
- Y æ–¹å‘å°é½ŠéŒ¯èª¤ï¼ˆå¦‚æœ height > widthï¼‰
- Ramp æ•ˆæœè®Šå½¢æˆ–åç§»

---

## ğŸ§ª æ¸¬è©¦ä»£ç¢¼

### é©—è­‰è¨ˆç®—æ­£ç¢ºæ€§

```typescript
// æ¸¬è©¦å‡½æ•¸
function testOffsetCalculation() {
    const testCases = [
        { w: 512, h: 512, name: "æ­£æ–¹å½¢" },
        { w: 696, h: 540, name: "çŸ©å½¢ï¼ˆå¯¦éš›æ¡ˆä¾‹ï¼‰" },
        { w: 1024, h: 768, name: "4:3" },
        { w: 1920, h: 1080, name: "16:9" },
        { w: 2048, h: 1024, name: "2:1" }
    ];
    
    console.log("Offset è¨ˆç®—æ¸¬è©¦ï¼š\n");
    
    testCases.forEach(({ w, h, name }) => {
        const offset = RampShaderResetInspector.calculateAutoRampUVOffset(w, h);
        const diff = Math.abs(offset.x - offset.y);
        
        console.log(`${name} [${w}, ${h}]:`);
        console.log(`  Offset X: ${offset.x.toFixed(6)}`);
        console.log(`  Offset Y: ${offset.y.toFixed(6)}`);
        console.log(`  å·®ç•°: ${diff.toFixed(6)}`);
        console.log(`  X = Y?: ${diff < 0.000001 ? "æ˜¯" : "å¦"}\n`);
    });
}
```

### é æœŸè¼¸å‡º

```
Offset è¨ˆç®—æ¸¬è©¦ï¼š

æ­£æ–¹å½¢ [512, 512]:
  Offset X: 0.498047
  Offset Y: 0.498047
  å·®ç•°: 0.000000
  X = Y?: æ˜¯

çŸ©å½¢ï¼ˆå¯¦éš›æ¡ˆä¾‹ï¼‰ [696, 540]:
  Offset X: 0.498563
  Offset Y: 0.498148
  å·®ç•°: 0.000415
  X = Y?: å¦

4:3 [1024, 768]:
  Offset X: 0.499023
  Offset Y: 0.498698
  å·®ç•°: 0.000325
  X = Y?: å¦

16:9 [1920, 1080]:
  Offset X: 0.499479
  Offset Y: 0.499074
  å·®ç•°: 0.000405
  X = Y?: å¦

2:1 [2048, 1024]:
  Offset X: 0.499512
  Offset Y: 0.499023
  å·®ç•°: 0.000489
  X = Y?: å¦
```

---

## ğŸ“ ç¸½çµ

### æ ¸å¿ƒçµè«–

1. **X å’Œ Y çš„ Offset ä¸åŒæ˜¯æ­£ç¢ºçš„** âœ…
   - åªæœ‰æ­£æ–¹å½¢ï¼ˆwidth = heightï¼‰æ™‚æ‰æœƒç›¸åŒ
   - çŸ©å½¢å¿…é ˆåˆ†åˆ¥è¨ˆç®—

2. **å…¬å¼å·²ç¶“æ­£ç¢ºå¯¦ç¾** âœ…
   ```typescript
   offsetX = 0.5 - (1.0 / width)
   offsetY = 0.5 - (1.0 / height)
   ```

3. **å¯¦éš›é©—è­‰é€šé** âœ…
   - è¨ˆç®—å€¼èˆ‡æˆªåœ–ä¸­çš„æ•¸å€¼å®Œå…¨ä¸€è‡´
   - Node UV Scale: X=0.002874, Y=0.003704
   - Ramp UV Offset: X=0.498563, Y=0.498148

### ç‚ºä»€éº¼ä¹‹å‰æœƒèª¤è§£ï¼Ÿ

å¯èƒ½çš„åŸå› ï¼š
1. ç›´è¦ºä¸Šèªç‚º offset æ‡‰è©²æ˜¯çµ±ä¸€çš„
2. æ²’æœ‰è€ƒæ…®åˆ°ä¸åŒè»¸å‘çš„åƒç´ å¯†åº¦å·®ç•°
3. æ²’æœ‰ç†è§£ UV æ­¸ä¸€åŒ–çš„ç¨ç«‹æ€§

### æ­£ç¢ºçš„ç†è§£

- **UV ç©ºé–“æ˜¯æ­¸ä¸€åŒ–çš„**ï¼šæ¯å€‹è»¸å‘ç¨ç«‹æ˜ å°„åˆ° [0, 1]
- **åƒç´ è£œå„Ÿæ˜¯ç›¸å°çš„**ï¼šç›¸å°æ–¼å„è‡ªè»¸å‘çš„ç¸½é•·åº¦
- **æ•¸å­¸é—œä¿‚æ˜¯ç·šæ€§çš„**ï¼šoffset âˆ 1 / contentSize

---

## ğŸ‰ çµè«–

**ç•¶å‰çš„å¯¦ç¾å®Œå…¨æ­£ç¢ºï¼**

å…¬å¼ `offset = 0.5 - (1.0 / contentSize)` å·²ç¶“ï¼š
âœ… æ­£ç¢ºè€ƒæ…®äº† X å’Œ Y çš„å·®ç•°  
âœ… æ ¹æ“šå„è‡ªçš„ contentSize åˆ†åˆ¥è¨ˆç®—  
âœ… å¯¦éš›æ•¸å€¼èˆ‡ç†è«–è¨ˆç®—å®Œå…¨åŒ¹é…  
âœ… é©ç”¨æ–¼æ‰€æœ‰çŸ©å½¢å’Œæ­£æ–¹å½¢å°ºå¯¸  

**ä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç¢¼ï¼** ğŸŠ

---

*æœ€å¾Œæ›´æ–°: 2025-10-17*
*ç‰ˆæœ¬: 1.0.0 - XY Offset å·®ç•°è§£é‡‹*
